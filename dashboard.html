<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI Rhythm Master - ì‹¤ì‹œê°„ ë°ì´í„° ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ğŸŒŸ ìˆ˜ì •ëœ ë¶€ë¶„: í•˜ë‹¨ íŒ¨ë”©(80px)ì„ ì¶”ê°€í•˜ì—¬ ìŠ¤í¬ë¡¤ ê³µê°„ í™•ë³´ */
        body { background-color: #f4f7f6; font-family: 'Pretendard', sans-serif; padding: 20px 20px 80px 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        /* ìš”ì•½ ì¹´ë“œ ê·¸ë¦¬ë“œ: ë°˜ì‘í˜•ìœ¼ë¡œ ìˆ˜ì • (í™”ë©´ ì¢ìœ¼ë©´ 1ì—´, ë„“ìœ¼ë©´ 3ì—´) */
        .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); text-align: center; }
        .card h3 { margin: 0; color: #666; font-size: 16px; }
        .card p { font-size: 28px; font-weight: bold; margin: 10px 0; color: #1a1a2e; }
        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ: ë°˜ì‘í˜•ìœ¼ë¡œ ìˆ˜ì • (í™”ë©´ ì¢ìœ¼ë©´ 1ì—´, ë„“ìœ¼ë©´ 2ì—´) */
        .chart-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; }
        /* ğŸŒŸ ì°¨íŠ¸ ì˜ì—­ ë†’ì´ ì§€ì • ë° ì˜ë¦¼ ë°©ì§€ */
        .chart-wrapper { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); height: 350px; position: relative; }
        canvas { width: 100% !important; height: 100% !important; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š AI Rhythm Master ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ</h1>
            <p>AI ë©”ì´ì»¤ êµìœ¡: ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘ ë° ë¶„ì„ ì‹œìŠ¤í…œ</p>
        </div>

        <div class="summary-grid">
            <div class="card"><h3>ëˆ„ì  í”Œë ˆì´ íšŸìˆ˜</h3><p id="total-games">ë¡œë”©ì¤‘...</p></div>
            <div class="card"><h3>í‰ê·  ì„±ì·¨ë„(ì •í™•ë„)</h3><p id="avg-acc">-</p></div>
            <div class="card"><h3>ìµœê³  ê¸°ë¡</h3><p id="high-score">-</p></div>
        </div>

        <div class="chart-container">
            <div class="chart-wrapper">
                <canvas id="poseChart"></canvas>
            </div>
            <div class="chart-wrapper">
                <canvas id="trendChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        // ë¶€ì¥ë‹˜ì˜ ìµœì‹  GAS ì›¹ ì•± URL
        const apiURL = "https://script.google.com/macros/s/AKfycbyNsrl2qXOpxWAI830Xb3Tts2MJshS7ahe0tbOFTC5sHsAWVkC5jyShkKTB5SFLhmM/exec";

        async function updateDashboard() {
            try {
                const response = await fetch(apiURL);
                const data = await response.json();

                if (!data || data.length === 0) {
                     document.getElementById("total-games").innerText = "ë°ì´í„° ì—†ìŒ";
                     return;
                }

                // 1. ìš”ì•½ í†µê³„ ì—…ë°ì´íŠ¸
                document.getElementById("total-games").innerText = data.length + "íšŒ";
                const avg = data.reduce((acc, cur) => acc + parseFloat(cur.accuracy), 0) / data.length;
                document.getElementById("avg-acc").innerText = avg.toFixed(1) + "%";
                document.getElementById("high-score").innerText = Math.max(...data.map(d => d.score)) + "ì ";

                // 2. ë™ì‘ë³„ ì„±ê³µ ë¶„í¬ ì°¨íŠ¸ (ì›í˜•)
                const totalPoses = {
                    left: data.reduce((acc, cur) => acc + cur.left, 0),
                    right: data.reduce((acc, cur) => acc + cur.right, 0),
                    both: data.reduce((acc, cur) => acc + cur.both, 0)
                };

                new Chart(document.getElementById('poseChart'), {
                    type: 'pie',
                    data: {
                        labels: ['ì™¼ì†', 'ì˜¤ë¥¸ì†', 'ì–‘ì†'],
                        datasets: [{
                            data: [totalPoses.left, totalPoses.right, totalPoses.both],
                            backgroundColor: ['#00f3ff', '#ff00ff', '#ffcc00'],
                            borderWidth: 1
                        }]
                    },
                    options: { 
                        responsive: true,
                        maintainAspectRatio: false, // ğŸŒŸ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶¤
                        plugins: { 
                            title: { display: true, text: 'ë™ì‘ë³„ ì„±ê³µ ë¶„í¬', font: { size: 16 } },
                            legend: { position: 'bottom' }
                        } 
                    }
                });

                // 3. ì •í™•ë„ ë³€í™” ì¶”ì´ ì°¨íŠ¸ (êº¾ì€ì„ )
                new Chart(document.getElementById('trendChart'), {
                    type: 'line',
                    data: {
                        labels: data.map((_, i) => i + 1 + "íšŒì°¨"),
                        datasets: [{
                            label: 'ì •í™•ë„(%)',
                            data: data.map(d => parseFloat(d.accuracy)),
                            borderColor: '#1a1a2e',
                            backgroundColor: 'rgba(26, 26, 46, 0.1)',
                            tension: 0.3, // ğŸŒŸ ì„ ì„ ë¶€ë“œëŸ½ê²Œ
                            fill: true,
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: { 
                        responsive: true,
                        maintainAspectRatio: false, // ğŸŒŸ ì»¨í…Œì´ë„ˆ í¬ê¸°ì— ë§ì¶¤
                        plugins: { 
                            title: { display: true, text: 'í•™ìŠµ ì„±ì·¨ë„ ì¶”ì´', font: { size: 16 } },
                            legend: { display: false }
                        },
                        scales: {
                            y: { beginAtZero: true, max: 100 } // Yì¶• 0~100 ê³ ì •
                        }
                    }
                });
            } catch (error) {
                console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", error);
                document.getElementById("total-games").innerText = "ì—°ê²° ì‹¤íŒ¨";
            }
        }

        updateDashboard();
    </script>
</body>
</html>
